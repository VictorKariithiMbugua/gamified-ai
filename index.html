<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Gamified Remote Storage — Vercel Edition</title>

<style>
body {
  font-family: monospace;
  background: #0f172a;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

#storage, #chat {
  width: 600px;
  border: 2px solid #555;
  border-radius: 10px;
  padding: 10px;
  background: rgba(30,41,59,0.85);
  margin-bottom: 10px;
}

#chat {
  height: 220px;
  overflow-y: auto;
}

input, button {
  width: 600px;
  padding: 10px;
  margin: 5px 0;
  border-radius: 5px;
  border: none;
}

button {
  background: #0ea5e9;
  color: white;
  cursor: pointer;
}

button:hover {
  background: #0284c7;
}

.slot {
  border: 1px solid #4ade80;
  margin: 4px;
  padding: 4px 6px;
  border-radius: 4px;
  display: inline-block;
  min-width: 90px;
  text-align: center;
}

.level {
  color: #4ade80;
  font-weight: bold;
}

pre {
  white-space: pre-wrap;
  font-size: 12px;
  opacity: 0.85;
}
</style>
</head>

<body>

<h2>Gamified Remote Storage — Vercel Edition</h2>

<div id="storage">
  Storage Slots:
  <span id="slots"></span>
</div>

<div id="chat"></div>

<input id="input" type="text" placeholder="Store or retrieve something…" />
<button onclick="interact()">Interact</button>

<div>Level: <span id="level" class="level">1</span></div>

<script>
/* MORSE DICTIONARY */
const MORSE = {
  A: ".-", B: "-...", C: "-.-.", D: "-..", E: ".", F: "..-.",
  G: "--.", H: "....", I: "..", J: ".---", K: "-.-", L: ".-..",
  M: "--", N: "-.", O: "---", P: ".--.", Q: "--.-", R: ".-.",
  S: "...", T: "-", U: "..-", V: "...-", W: ".--", X: "-..-",
  Y: "-.--", Z: "--..",
  0: "-----", 1: ".----", 2: "..---", 3: "...--", 4: "....-",
  5: ".....", 6: "-....", 7: "--...", 8: "---..", 9: "----.",
  " ": "/"
};

/* STATE */
let storage = [];
let level = 1;

/* ELEMENTS */
const chatBox = document.getElementById("chat");
const slotsEl = document.getElementById("slots");
const levelEl = document.getElementById("level");
const inputEl = document.getElementById("input");

/* HELPERS */
function toMorse(text) {
  return text
    .toUpperCase()
    .split("")
    .map(c => MORSE[c] || "")
    .join(" ");
}

function updateStorage() {
  slotsEl.innerHTML = "";
  storage.forEach(item => {
    const slot = document.createElement("div");
    slot.className = "slot";
    slot.textContent = item.name;
    slotsEl.appendChild(slot);
  });
}

function appendChat(sender, html) {
  chatBox.innerHTML += `<div><b>${sender}:</b> ${html}</div>`;
  chatBox.scrollTop = chatBox.scrollHeight;
}

/* MAIN INTERACTION */
async function interact() {
  const msg = inputEl.value.trim();
  if (!msg) return;
  inputEl.value = "";

  appendChat("You", msg);

  let replyText;

  try {
    const res = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: msg })
    });

    const data = await res.json();
    replyText = data.reply || "No reply returned.";

  } catch (e) {
    replyText = "Error contacting API.";
  }

  const morse = toMorse(replyText);

  appendChat(
    "AI",
    `${replyText}<pre>${morse}</pre>`
  );

  storage.push({ name: msg, summary: replyText });
  level++;
  levelEl.textContent = level;
  updateStorage();
}
</script>

</body>
</html>
